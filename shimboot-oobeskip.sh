#!/bin/bash
# made by HarryJarry1

echo "Welcome to oobeskip for shimboot"
echo "This script allows you to skip the oobe, and get into a temporary unenrolled environment without needing to actually unenroll."

# Replace Local State with embedded JSON content

rm '/home/chronos/Local State'
cat << 'EOF' > /bootloader/oobeskip_state
{"CachedMultiProfileUserBehavior":{},"DeviceRegistered":1,"EnrollmentRecoveryRequired":false,"EulaAccepted":true,"KnownUsers":[{"PasswordTokenHandle":"eth.ALh9Bwii-vjK98FVDOTg2Jj8T02kiwaK73xTX0NnJVqaPSiMKUH-lIl3xqy1hzHGcI4t1uHrDhp5xOWYr4UIyjGPBV0EP5kawDgacOu7qIQloRXDtwptQV44FXMnD3wuosEvWoEWbfsL8EDNT40jjnZL584b6LyKXfMX-0tuByliY4Igjyvk7wM","TokenHandleLastChecked":"13343613489173992","TokenHandleRotated":true,"TokenHandleStatus":"valid","UserSpokenFeedbackEnabled":false,"account_type":"google","arc":{"compatible_filesystem":{"chosen":1}},"ash":{"dark_mode":{"enabled":true}},"device_id":"bb35e195-92fb-4888-be0c-d38c308d6ea5","email":"jeffplays1292@gmail.com","gaia_id":"107028265486307779370","is_enterprise_managed":false,"last_input_method":"_comp_ime_jkghodnilhceideoidjikpgommlajknkxkb:us::eng","last_online_singin":"13343613488741795","login_display_password_button_enabled":true,"onboarding_completed_version":"105.0.5195.112","profile_requires_policy":false,"settings":{"clock":{"use_24hour_clock":false},"language":{"remap_backspace_key_to":6,"remap_caps_lock_key_to":4,"remap_escape_key_to":5,"remap_external_command_key_to":1,"remap_external_meta_key_to":0,"xkb_auto_repeat_delay_r2":500,"xkb_auto_repeat_enabled_r2":true,"xkb_auto_repeat_interval_r2":50,"xkb_remap_alt_key_to":2,"xkb_remap_control_key_to":1,"xkb_remap_search_key_to":0}}}],"LastActiveUser":"jeffplays1292@gmail.com","LastLoggedInRegularUser":"jeffplays1292@gmail.com","LoggedInUsers":["jeffplays1292@gmail.com"],"OAuthTokenStatus":{"jeffplays1292@gmail.com":4},"OobeComplete":true,"PreferredKeyboardLayout":"_comp_ime_jkghodnilhceideoidjikpgommlajknkxkb:us::eng","ServicesCustomizationApplied":true,"SharedExtensions":{},"UserDisplayEmail":{"jeffplays1292@gmail.com":"jeffplays1292@gmail.com"},"UserDisplayName":{"jeffplays1292@gmail.com":"Ignore this"},"UserForceOnlineSignin":{"jeffplays1292@gmail.com":false},"UserGivenName":{"jeffplays1292@gmail.com":"Ignore this"},"UserType":{"g-107028265486307779370":0},"arc":{"metrics":{"stability":{}},"serialno_salt":""},"ash":{"browser_data_migrator":{"migration_attempt_count":{},"move_migration_resume_count":{},"move_migration_resume_step":{}},"system":{"bluetooth":{"adapter_enabled":true}},"wallpaper":{"k_mean_colors":{"https://lh6.googleusercontent.com/proxy/Wjahp0me7RVBtrQE-tajpUkpDsh4uRobETYNIB2SNkddOa-eQxMcTI-Ny6zkhevUddhXu5fR1BYY8Kbeoyacd1ZIJ2xH5eEj3rhjZ-4k3iImMqM84Fh-ZVegajnGUPE749LrY3oqddUldPj5EiI":4278387459.0},"prominent_colors":{"https://lh6.googleusercontent.com/proxy/Wjahp0me7RVBtrQE-tajpUkpDsh4uRobETYNIB2SNkddOa-eQxMcTI-Ny6zkhevUddhXu5fR1BYY8Kbeoyacd1ZIJ2xH5eEj3rhjZ-4k3iImMqM84Fh-ZVegajnGUPE749LrY3oqddUldPj5EiI":[0.0,0.0,0.0,4282467412.0,4284506994.0,0.0]}}},"auto_screen_brightness":{"metrics":{"daily_sample":"13343613532322344"}},"component_updater_metadata":{"installed_items":[]},"demo_mode_resources_remover":{"accumulated_device_usage_s":49},"easy_unlock":{"device_id":"ec4d40b7-be3d-4419-8933-7e49740f9d35","user_prefs":{"jeffplays1292@gmail.com":{"easy_unlock.allowed":true,"proximity_auth.has_shown_login_disabled_message":false,"proximity_auth.is_chromeos_login_enabled":false,"smart_lock.enabled":false,"smart_lock_signin.allowed":true}}},"gcm":{"product_category_for_subtypes":"com.chrome.chromeos"},"hardware_acceleration_mode_previous":true,"intl":{"app_locale":"en-US","owner_locale":"en-US"},"invalidation":{"per_sender_topics_to_handler":{"1013309121859":{}}},"key_permissions_one_time_migration_done":true,"lacros":{"profile_migration_completed_for_user":{},"profile_move_migration_completed_for_user":{}},"local_search_service":{"metrics":{"daily_sample":"13343613488631767"}},"network_time":{"network_time_mapping":{"local":1.699139943258732e+12,"network":1.69913993e+12,"ticks":108315467.0,"uncertainty":1090746.0}},"oom_kills":{"daily_count":0},"oomkills":{"daily_sample":"13343613488348358"},"origin_trials":{"disabled_features":["WebGPU"]},"policy":{"last_statistics_update":"13343613441656723"},"power":{"metrics":{"daily_sample":"13343613441911020","idle_screen_dim_count":0,"idle_screen_off_count":0,"idle_suspend_count":0,"lid_closed_suspend_count":0}},"profile":{"info_cache":{"Default":{"avatar_icon":"chrome://theme/IDR_PROFILE_AVATAR_26","background_apps":false,"force_signin_profile_locked":false,"gaia_id":"","is_consented_primary_account":false,"is_ephemeral":false,"is_using_default_avatar":true,"is_using_default_name":true,"managed_user_id":"","name":"First user","signin.with_credential_provider":false,"user_name":""},"u-44bdb29a288d9729d208a07f0156cc779f3c6cf9":{"account_id_key":"g-107028265486307779370","active_time":1699139932.126806,"avatar_icon":"chrome://theme/IDR_PROFILE_AVATAR_26","background_apps":false,"default_avatar_fill_color":-14483456,"default_avatar_stroke_color":-1,"force_signin_profile_locked":false,"gaia_id":"107028265486307779370","is_consented_primary_account":true,"is_ephemeral":false,"is_using_default_avatar":true,"is_using_default_name":true,"managed_user_id":"","name":"First user","profile_highlight_color":-14483456,"signin.with_credential_provider":false,"user_name":"jeffplays1292@gmail.com"}},"last_active_profiles":[],"last_used":"u-44bdb29a288d9729d208a07f0156cc779f3c6cf9"},"profile_network_context_service":{"http_cache_finch_experiment_groups":"None None None None"},"quirks_client":{"last_server_check":{"49143412":1699139889.191838}},"segmentation_platform":{"ukm_most_recent_allowed_time_key":"13343613491376784"},"session":{"start_time":"13343613488348426","user_activity_seen":true},"session_id_generator_last_value":"490852053","settings":{"audio":{"devices":{"gain_percent":{"2315562897 : 1":50.0,"2356475750 : 1":50.0,"3962083865 : 1":50.0}}},"consumer_auto_update_toggle":true,"display":{"external_display_mirror_info":[],"mixed_mirror_mode_param":{},"port_associations":{},"power_state":"all_on","properties":{"20570490453689600":{"display_zoom_factor":1.0,"rotation":0}},"rotation_lock":{"lock":false,"orientation":0},"touch_associations":{}},"signin_screen_timezone":"America/New_York"},"shutdown":{"num_processes":0,"num_processes_slow":0,"type":0},"signed_settings_cache":"..."}
EOF

cp /bootloader/oobeskip_state '/home/chronos/Local State'

read -p "Do you want to restart the ui now? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    restart ui
fi
